(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{141:function(e,t,r){},201:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(10),c=r.n(s),o=(r(141),r(242)),i=r(49),u=r(12),l=r(75),d=r(116),j=r.n(d),b=r(117),f=r(57),h="GET_USER",p="SET_FETCHING_STATUS",m=function(e){return{type:h,user:e}},x=function(e){return{type:p,isFetching:e}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return t.user;case p:return Object(f.a)(Object(f.a)({},e),{},{isFetching:t.isFetching});default:return e}},O=r(88),v=function(e,t){var r=t.message,n=t.sender;if(null!==n){var a={id:r.conversationId,otherUser:n,messages:[r]};return a.latestMessageText=r.text,[a].concat(Object(O.a)(e))}return e.map((function(e){return e.id===r.conversationId?(e.messages.push(r),e.latestMessageText=r.text,e):e}))},w=function(e,t){return e.map((function(e){if(e.otherUser.id===t){var r=Object(f.a)({},e);return r.otherUser.online=!0,r}return e}))},y=function(e,t){return e.map((function(e){if(e.otherUser.id===t){var r=Object(f.a)({},e);return r.otherUser.online=!1,r}return e}))},S=function(e,t){var r={};e.forEach((function(e){r[e.otherUser.id]=!0}));var n=Object(O.a)(e);return t.forEach((function(e){if(!r[e.id]){var t={otherUser:e,messages:[]};n.push(t)}})),n},C=function(e,t,r){return e.map((function(e){return e.otherUser.id===t?(e.id=r.conversationId,e.messages.push(r),e.latestMessageText=r.text,e):e}))},k="GET_CONVERSATIONS",E="SET_MESSAGE",U="ADD_ONLINE_USER",N="REMOVE_OFFLINE_USER",I="SET_SEARCHED_USERS",F="CLEAR_SEARCHED_USERS",T="ADD_CONVERSATION",D=function(e,t){return{type:E,payload:{message:e,sender:t||null}}},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return t.conversations;case E:return v(e,t.payload);case U:return w(e,t.id);case N:return y(e,t.id);case I:return S(e,t.users);case F:return e.filter((function(e){return e.id}));case T:return C(e,t.payload.recipientId,t.payload.newMessage);default:return e}},R="SET_ACTIVE_CHAT",B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.username;default:return e}},L="CLEAR_ON_LOGOUT",_=Object(l.b)({user:g,conversations:A,activeConversation:B}),P=Object(l.c)((function(e,t){return t.type===L&&(e=void 0),_(e,t)}),Object(l.a)(b.a,j.a)),W=r(126),z=Object(W.a)({typography:{fontFamily:"Open Sans, sans-serif",fontSize:14,button:{textTransform:"none",letterSpacing:0,fontWeight:"bold"}},overrides:{MuiInput:{input:{fontWeight:"bold"}}},palette:{primary:{main:"#3A8DFF"},secondary:{main:"#B0B0B0"}}}),M=r(27),G=r(16),q=r(7),H=r.n(q),V=r(15),J=r(42),$=r.n(J),K=r(121),Q=r.n(K)()(window.location.origin);Q.on("connect",(function(){console.log("connected to server"),Q.on("add-online-user",(function(e){P.dispatch(function(e){return{type:U,id:e}}(e))})),Q.on("remove-offline-user",(function(e){P.dispatch(function(e){return{type:N,id:e}}(e))})),Q.on("new-message",(function(e){P.dispatch(D(e.message,e.sender))}))}));var X=Q;$.a.interceptors.request.use(function(){var e=Object(V.a)(H.a.mark((function e(t){var r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("messenger-token");case 2:return r=e.sent,t.headers["x-access-token"]=r,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var Y=function(){return function(){var e=Object(V.a)(H.a.mark((function e(t){var r,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.a.get("/api/conversations");case 3:r=e.sent,n=r.data,t({type:k,conversations:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},Z=function(){var e=Object(V.a)(H.a.mark((function e(t){var r,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.a.post("/api/messages",t);case 2:return r=e.sent,n=r.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=function(e,t){X.emit("new-message",{message:e.message,recipientId:t.recipientId,sender:e.sender})},te=r(231),re=r(244),ne=r(204),ae=r(245),se=r(234),ce=r(243),oe=r(237),ie=r(2),ue=Object(u.b)((function(e){return{user:e.user}}),(function(e){return{register:function(t){e(function(e){return function(){var t=Object(V.a)(H.a.mark((function t(r){var n,a;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,$.a.post("/auth/register",e);case 3:return n=t.sent,a=n.data,t.next=7,localStorage.setItem("messenger-token",a.token);case 7:r(m(a)),X.emit("go-online",a.id),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),r(m({error:t.t0.response.data.error||"Server Error"}));case 15:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=Object(G.g)(),r=e.user,a=e.register,s=Object(n.useState)({}),c=Object(M.a)(s,2),o=c[0],i=c[1],u=function(){var e=Object(V.a)(H.a.mark((function e(t){var r,n,s,c;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),r=t.target.username.value,n=t.target.email.value,s=t.target.password.value,c=t.target.confirmPassword.value,s===c){e.next=8;break}return i({confirmPassword:"Passwords must match"}),e.abrupt("return");case 8:return e.next=10,a({username:r,email:n,password:s});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.id?Object(ie.jsx)(G.a,{to:"/home"}):Object(ie.jsx)(te.a,{container:!0,justify:"center",children:Object(ie.jsxs)(re.a,{children:[Object(ie.jsxs)(te.a,{container:!0,item:!0,children:[Object(ie.jsx)(ne.a,{children:"Need to log in?"}),Object(ie.jsx)(ae.a,{onClick:function(){return t.push("/login")},children:"Login"})]}),Object(ie.jsx)("form",{onSubmit:u,children:Object(ie.jsxs)(te.a,{children:[Object(ie.jsx)(te.a,{children:Object(ie.jsx)(se.a,{children:Object(ie.jsx)(ce.a,{"aria-label":"username",label:"Username",name:"username",type:"text",required:!0})})}),Object(ie.jsx)(te.a,{children:Object(ie.jsx)(se.a,{children:Object(ie.jsx)(ce.a,{label:"E-mail address","aria-label":"e-mail address",type:"email",name:"email",required:!0})})}),Object(ie.jsx)(te.a,{children:Object(ie.jsxs)(se.a,{error:!!o.confirmPassword,children:[Object(ie.jsx)(ce.a,{"aria-label":"password",label:"Password",type:"password",inputProps:{minLength:6},name:"password",required:!0}),Object(ie.jsx)(oe.a,{children:o.confirmPassword})]})}),Object(ie.jsx)(te.a,{children:Object(ie.jsxs)(se.a,{error:!!o.confirmPassword,children:[Object(ie.jsx)(ce.a,{label:"Confirm Password","aria-label":"confirm password",type:"password",inputProps:{minLength:6},name:"confirmPassword",required:!0}),Object(ie.jsx)(oe.a,{children:o.confirmPassword})]})}),Object(ie.jsx)(ae.a,{type:"submit",variant:"contained",size:"large",children:"Create"})]})})]})})})),le=Object(u.b)((function(e){return{user:e.user}}),(function(e){return{login:function(t){e(function(e){return function(){var t=Object(V.a)(H.a.mark((function t(r){var n,a;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,$.a.post("/auth/login",e);case 3:return n=t.sent,a=n.data,t.next=7,localStorage.setItem("messenger-token",a.token);case 7:r(m(a)),X.emit("go-online",a.id),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),r(m({error:t.t0.response.data.error||"Server Error"}));case 15:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=Object(G.g)(),r=e.user,n=e.login,a=function(){var e=Object(V.a)(H.a.mark((function e(t){var r,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=t.target.username.value,a=t.target.password.value,e.next=5,n({username:r,password:a});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.id?Object(ie.jsx)(G.a,{to:"/home"}):Object(ie.jsx)(te.a,{container:!0,justify:"center",children:Object(ie.jsxs)(re.a,{children:[Object(ie.jsxs)(te.a,{container:!0,item:!0,children:[Object(ie.jsx)(ne.a,{children:"Need to register?"}),Object(ie.jsx)(ae.a,{onClick:function(){return t.push("/register")},children:"Register"})]}),Object(ie.jsx)("form",{onSubmit:a,children:Object(ie.jsxs)(te.a,{children:[Object(ie.jsx)(te.a,{children:Object(ie.jsx)(se.a,{margin:"normal",required:!0,children:Object(ie.jsx)(ce.a,{"aria-label":"username",label:"Username",name:"username",type:"text"})})}),Object(ie.jsx)(se.a,{margin:"normal",required:!0,children:Object(ie.jsx)(ce.a,{label:"password","aria-label":"password",type:"password",name:"password"})}),Object(ie.jsx)(te.a,{children:Object(ie.jsx)(ae.a,{type:"submit",variant:"contained",size:"large",children:"Login"})})]})})]})})})),de=r(241),je=r(238),be=Object(je.a)((function(e){return{root:{display:"flex",justifyContent:"space-between",marginLeft:20,flexGrow:1},username:{fontWeight:"bold",letterSpacing:-.2},previewText:{fontSize:12,color:"#9CADC8",letterSpacing:-.17}}})),fe=function(e){var t=be(),r=e.conversation,n=r.latestMessageText,a=r.otherUser;return Object(ie.jsx)(re.a,{className:t.root,children:Object(ie.jsxs)(re.a,{children:[Object(ie.jsx)(ne.a,{className:t.username,children:a.username}),Object(ie.jsx)(ne.a,{className:t.previewText,children:n})]})})},he=r(74),pe=r.n(he),me=Object(je.a)((function(){return{root:{height:44,marginTop:23,marginLeft:6,display:"flex",alignItems:"center"},subContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",flexGrow:1},username:{letterSpacing:-.23,fontSize:16,fontWeight:"bold",marginLeft:17},ellipsis:{color:"#95A7C4",marginRight:24,opacity:.5}}})),xe=Object(u.b)((function(e){return{user:e.user}}))((function(e){var t=me(),r=e.user||{};return Object(ie.jsxs)(re.a,{className:t.root,children:[Object(ie.jsx)(De,{photoUrl:r.photoUrl,online:!0}),Object(ie.jsxs)(re.a,{className:t.subContainer,children:[Object(ie.jsx)(ne.a,{className:t.username,children:r.username}),Object(ie.jsx)(pe.a,{classes:{root:t.ellipsis}})]})]})})),ge=r(235),Oe=r(239),ve=r(123),we=r.n(ve),ye=Object(je.a)((function(){return{filledInput:{height:50,background:"#E9EEF9",borderRadius:5,fontSize:13,fontWeight:"bold",color:"#99A9C4",letterSpacing:0,display:"flex",justifyContent:"center",marginBottom:20},input:{"&::placeholder":{color:"#ADC0DE",opacity:1}}}})),Se=function(e){var t=ye(),r=e.handleChange;return Object(ie.jsx)("form",{onSubmit:function(e){e.preventDefault()},children:Object(ie.jsx)(se.a,{fullWidth:!0,hiddenLabel:!0,children:Object(ie.jsx)(ge.a,{name:"search",onChange:r,classes:{root:t.filledInput,input:t.input},disableUnderline:!0,placeholder:"Search",startAdornment:Object(ie.jsx)(Oe.a,{position:"start",children:Object(ie.jsx)(we.a,{})})})})})},Ce=Object(je.a)((function(){return{root:{paddingLeft:21,paddingRight:21,flexGrow:1},title:{fontSize:20,letterSpacing:-.29,fontWeight:"bold",marginTop:32,marginBottom:15}}})),ke=Object(u.b)((function(e){return{conversations:e.conversations}}))((function(e){var t=Ce(),r=e.conversations||[],n=e.handleChange,a=e.searchTerm;return Object(ie.jsxs)(re.a,{className:t.root,children:[Object(ie.jsx)(xe,{}),Object(ie.jsx)(ne.a,{className:t.title,children:"Chats"}),Object(ie.jsx)(Se,{handleChange:n}),r.filter((function(e){var t;return null===(t=e.otherUser)||void 0===t?void 0:t.username.includes(a)})).map((function(e){var t;return Object(ie.jsx)(Ne,{conversation:e},null===(t=e.otherUser)||void 0===t?void 0:t.username)}))]})})),Ee=Object(u.b)(null,(function(e){return{searchUsers:function(t){var r;e((r=t,function(){var e=Object(V.a)(H.a.mark((function e(t){var n,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.a.get("/api/users/".concat(r));case 3:n=e.sent,a=n.data,t({type:I,users:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()))},clearSearchedUsers:function(){e({type:F})}}}))((function(e){var t=e.searchUsers,r=e.clearSearchedUsers,a=Object(n.useState)(""),s=Object(M.a)(a,2),c=s[0],o=s[1],i=function(){var e=Object(V.a)(H.a.mark((function e(n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==n.target.value){e.next=4;break}return r(),o(""),e.abrupt("return");case 4:if(!c.includes(n.target.value)){e.next=7;break}return o(n.target.value),e.abrupt("return");case 7:return e.next=9,t(n.target.value);case 9:o(n.target.value);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ie.jsx)(ke,{handleChange:i,searchTerm:c})})),Ue=Object(je.a)((function(e){return{root:{borderRadius:8,height:80,boxShadow:"0 2px 10px 0 rgba(88,133,196,0.05)",marginBottom:10,display:"flex",alignItems:"center","&:hover":{cursor:"grab"}}}})),Ne=Object(u.b)(null,(function(e){return{setActiveChat:function(t){e({type:R,username:t})}}}))((function(e){var t=Ue(),r=e.conversation,n=r.otherUser,a=function(){var t=Object(V.a)(H.a.mark((function t(r){return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setActiveChat(r.otherUser.username);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(ie.jsxs)(re.a,{onClick:function(){return a(r)},className:t.root,children:[Object(ie.jsx)(De,{photoUrl:n.photoUrl,username:n.username,online:n.online,sidebar:!0}),Object(ie.jsx)(fe,{conversation:r})]})})),Ie=r(240),Fe=r(248),Te=Object(je.a)((function(){return{profilePic:{height:44,width:44},badge:{height:13,width:13,borderRadius:"50%",border:"2px solid white",backgroundColor:"#D0DAE9"},online:{backgroundColor:"#1CED84"},sidebar:{marginLeft:17}}})),De=function(e){var t=Te(),r=e.sidebar,n=e.username,a=e.photoUrl,s=e.online;return Object(ie.jsx)(re.a,{className:r?t.sidebar:"",children:Object(ie.jsx)(Ie.a,{classes:{badge:"".concat(t.badge," ").concat(s&&t.online)},variant:"dot",anchorOrigin:{horizontal:"right",vertical:"bottom"},overlap:"circle",children:Object(ie.jsx)(Fe.a,{alt:n,src:a,className:t.profilePic})})})},Ae=Object(je.a)((function(){return{root:{display:"flex",flexDirection:"column",alignItems:"flex-end"},date:{fontSize:11,color:"#BECCE2",fontWeight:"bold",marginBottom:5},text:{fontSize:14,color:"#91A3C0",letterSpacing:-.2,padding:8,fontWeight:"bold"},bubble:{background:"#F4F6FA",borderRadius:"10px 10px 0 10px"}}})),Re=function(e){var t=Ae(),r=e.time,n=e.text;return Object(ie.jsxs)(re.a,{className:t.root,children:[Object(ie.jsx)(ne.a,{className:t.date,children:r}),Object(ie.jsx)(re.a,{className:t.bubble,children:Object(ie.jsx)(ne.a,{className:t.text,children:n})})]})},Be=Object(je.a)((function(){return{root:{display:"flex"},avatar:{height:30,width:30,marginRight:11,marginTop:6},usernameDate:{fontSize:11,color:"#BECCE2",fontWeight:"bold",marginBottom:5},bubble:{backgroundImage:"linear-gradient(225deg, #6CC1FF 0%, #3A8DFF 100%)",borderRadius:"0 10px 10px 10px"},text:{fontSize:14,fontWeight:"bold",color:"#FFFFFF",letterSpacing:-.2,padding:8}}})),Le=function(e){var t=Be(),r=e.text,n=e.time,a=e.otherUser;return Object(ie.jsxs)(re.a,{className:t.root,children:[Object(ie.jsx)(Fe.a,{alt:a.username,src:a.photoUrl,className:t.avatar}),Object(ie.jsxs)(re.a,{children:[Object(ie.jsxs)(ne.a,{className:t.usernameDate,children:[a.username," ",n]}),Object(ie.jsx)(re.a,{className:t.bubble,children:Object(ie.jsx)(ne.a,{className:t.text,children:r})})]})]})},_e=Object(je.a)((function(){return{root:{display:"flex",flexGrow:8,flexDirection:"column"},chatContainer:{marginLeft:41,marginRight:41,display:"flex",flexDirection:"column",flexGrow:1,justifyContent:"space-between"}}})),Pe=Object(u.b)((function(e){return{user:e.user,conversation:e.conversations&&e.conversations.find((function(t){return t.otherUser.username===e.activeConversation}))}}),null)((function(e){var t=_e(),r=e.user,n=e.conversation||{};return Object(ie.jsx)(re.a,{className:t.root,children:n.otherUser&&Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsx)(Ge,{username:n.otherUser.username,online:n.otherUser.online||!1}),Object(ie.jsxs)(re.a,{className:t.chatContainer,children:[Object(ie.jsx)(Ve,{messages:n.messages,otherUser:n.otherUser,userId:r.id}),Object(ie.jsx)(ze,{otherUser:n.otherUser,conversationId:n.id,user:r})]})]})})})),We=Object(je.a)((function(){return{root:{justifySelf:"flex-end",marginTop:15},input:{height:70,backgroundColor:"#F4F6FA",borderRadius:8,marginBottom:20}}})),ze=Object(u.b)(null,(function(e){return{postMessage:function(t){var r;e((r=t,function(){var e=Object(V.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z(r);case 3:return n=e.sent,r.conversationId?t(D(n.message)):(t((a=r.recipientId,s=n.message,{type:T,payload:{recipientId:a,newMessage:s}})),t(Y())),e.next=7,ee(n,r);case 7:t(Y()),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}var a,s}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()))}}}))((function(e){var t=We(),r=Object(n.useState)(""),a=Object(M.a)(r,2),s=a[0],c=a[1],o=e.postMessage,i=e.otherUser,u=e.conversationId,l=e.user,d=function(){var e=Object(V.a)(H.a.mark((function e(t){var r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r={text:t.target.text.value,recipientId:i.id,conversationId:u,sender:u?null:l},e.next=4,o(r);case 4:c("");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ie.jsx)("form",{className:t.root,onSubmit:d,children:Object(ie.jsx)(se.a,{fullWidth:!0,hiddenLabel:!0,children:Object(ie.jsx)(ge.a,{classes:{root:t.input},disableUnderline:!0,placeholder:"Type something...",value:s,name:"text",onChange:function(e){c(e.target.value)}})})})})),Me=Object(je.a)((function(e){return{root:{display:"flex",alignItems:"center",justifyContent:"space-between",height:89,marginBottom:34,boxShadow:"0 2px 20px 0 rgba(88,133,196,0.10)"},content:{display:"flex",alignItems:"center",marginLeft:24},username:{fontSize:20,letterSpacing:-.29,fontWeight:"bold",marginRight:14},statusText:{fontSize:12,color:"#BFC9DB",letterSpacing:-.17},statusDot:{height:8,width:8,borderRadius:"50%",marginRight:5,backgroundColor:"#D0DAE9"},online:{background:"#1CED84"},ellipsis:{color:"#95A7C4",marginRight:24,opacity:.5}}})),Ge=function(e){var t=Me(),r=e.username,n=e.online;return Object(ie.jsxs)(re.a,{className:t.root,children:[Object(ie.jsxs)(re.a,{className:t.content,children:[Object(ie.jsx)(ne.a,{className:t.username,children:r}),Object(ie.jsx)(re.a,{className:"".concat(t.statusDot," ").concat(t[n&&"online"])}),Object(ie.jsx)(ne.a,{className:t.statusText,children:n?"Online":"Offline"})]}),Object(ie.jsx)(pe.a,{classes:{root:t.ellipsis}})]})},qe=r(124),He=r.n(qe),Ve=function(e){var t=e.messages,r=e.otherUser,n=e.userId;return Object(ie.jsx)(re.a,{children:t.map((function(e){var t=He()(e.createdAt).format("h:mm");return e.senderId===n?Object(ie.jsx)(Re,{text:e.text,time:t},e.id):Object(ie.jsx)(Le,{text:e.text,time:t,otherUser:r},e.id)}))})},Je=Object(je.a)((function(e){return{root:{height:"100vh"}}})),$e=Object(u.b)((function(e){return{user:e.user,conversations:e.conversations}}),(function(e){return{logout:function(t){e(function(e){return function(){var t=Object(V.a)(H.a.mark((function t(r){return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,$.a.delete("/auth/logout");case 3:return t.next=5,localStorage.removeItem("messenger-token");case 5:r(m({})),X.emit("logout",e),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()}(t)),e({type:L})},fetchConversations:function(){e(Y())}}}))((function(e){var t=Je(),r=e.user,a=e.logout,s=e.fetchConversations,c=Object(n.useState)(!1),o=Object(M.a)(c,2),i=o[0],u=o[1];if(Object(n.useEffect)((function(){r.id&&u(!0)}),[r.id]),Object(n.useEffect)((function(){s()}),[s]),!r.id)return i?Object(ie.jsx)(G.a,{to:"/login"}):Object(ie.jsx)(G.a,{to:"/register"});var l=function(){var e=Object(V.a)(H.a.mark((function e(){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(r.id);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsx)(ae.a,{className:t.logout,onClick:l,children:"Logout"}),Object(ie.jsxs)(te.a,{container:!0,component:"main",className:t.root,children:[Object(ie.jsx)(de.a,{}),Object(ie.jsx)(Ee,{}),Object(ie.jsx)(Pe,{})]})]})})),Ke=r(247),Qe=r(125),Xe=r.n(Qe),Ye=Object(je.a)((function(e){return{snackbar:{backgroundColor:"red",fontWeight:"bold"},icon:{color:"white"}}})),Ze=function(e){var t=Ye();return Object(ie.jsx)(Ke.a,{open:e.snackBarOpen,onClose:function(){return e.setSnackBarOpen(!1)},message:e.errorMessage||"Sorry, an error occured. Please try again",action:Object(ie.jsx)(a.a.Fragment,{children:Object(ie.jsx)(ae.a,{className:t.icon,size:"small",onClick:function(){return e.setSnackBarOpen(!1)},children:Object(ie.jsx)(Xe.a,{color:"secondary"})})}),ContentProps:{classes:{root:t.snackbar}}})},et=Object(G.h)(Object(u.b)((function(e){return{user:e.user}}),(function(e){return{fetchUser:function(){e(function(){var e=Object(V.a)(H.a.mark((function e(t){var r,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(x(!0)),e.prev=1,e.next=4,$.a.get("/auth/user");case 4:r=e.sent,n=r.data,t(m(n)),n.id&&X.emit("go-online",n.id),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0);case 13:return e.prev=13,t(x(!1)),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t){return e.apply(this,arguments)}}())}}}))((function(e){var t=e.user,r=e.fetchUser,a=Object(n.useState)(""),s=Object(M.a)(a,2),c=s[0],o=s[1],i=Object(n.useState)(!1),u=Object(M.a)(i,2),l=u[0],d=u[1];return Object(n.useEffect)((function(){r()}),[r]),Object(n.useEffect)((function(){t.error&&("string"===typeof t.error?o(t.error):o("Internal Server Error. Please try again"),d(!0))}),[t.error]),e.user.isFetchingUser?Object(ie.jsx)("div",{children:"Loading..."}):Object(ie.jsxs)(ie.Fragment,{children:[l&&Object(ie.jsx)(Ze,{setSnackBarOpen:d,errorMessage:c,snackBarOpen:l}),Object(ie.jsxs)(G.d,{children:[Object(ie.jsx)(G.b,{path:"/login",component:le}),Object(ie.jsx)(G.b,{path:"/register",component:ue}),Object(ie.jsx)(G.b,{exact:!0,path:"/",render:function(e){var t;return(null===(t=e.user)||void 0===t?void 0:t.id)?Object(ie.jsx)($e,{}):Object(ie.jsx)(ue,{})}}),Object(ie.jsx)(G.b,{path:"/home",component:$e})]})]})})));var tt=function(){return Object(ie.jsx)(u.a,{store:P,children:Object(ie.jsx)(o.a,{theme:z,children:Object(ie.jsx)(i.a,{children:Object(ie.jsx)(et,{})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(ie.jsx)(tt,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[201,1,2]]]);
//# sourceMappingURL=main.29bc9b0d.chunk.js.map